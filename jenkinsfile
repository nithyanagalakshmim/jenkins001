pipeline {
    agent any
    triggers {
        cron('H/30 * * * *')  // Runs every 30 minutes
    }
    stages {
        stage('Install Dependencies') {
            steps {
                bat 'npm install -D @playwright/test'
                bat 'npx playwright install'
            }
        }
        stage('Run Tests') {
            steps {
                bat 'npx playwright test --workers=1 --project=chromium --reporter=junit,json --output=test-results || exit 0'
            }
        }
    }
    post {
        failure {
            emailext subject: '❌ Jenkins Playwright Test Failed!',
                     body: 'Test execution failed. Check the logs here: ${BUILD_URL}',
                     to: 'nithya.m@kryptosinfosys.com , nithyanagalakshmi2002@gmail.com'
        }
        success {
            emailext subject: '✅ Jenkins Playwright Test Passed!',
                     body: 'Test execution was successful. Check details here: ${BUILD_URL}',
                     to: 'nithya.m@kryptosinfosys.com , nithyanagalakshmi2002@gmail.com'
        }
    }
}
